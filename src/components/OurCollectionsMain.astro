---
import reception2 from '../assets/images/reception2.jpg';
import conferenceHall from '../assets/images/confrenceHall.jpg';
import reception1 from '../assets/images/reception1.jpg';
import kitchen from '../assets/images/kitchen.jpg';


import 'swiper/css';
import 'swiper/css/navigation';
import 'swiper/css/pagination';

const collections = [
  {
    index: '01',
    title: 'Декоративные панели',
    desc: 'Пространство, которое подчеркивает статус ваших конференций.',
    img: reception2.src,
    link: '#',
  },
  {
    index: '03',
    title: 'Конференц залы',
    desc: 'Пространство, которое подчеркивает статус ваших конференций.',
    img: conferenceHall.src,
    link: '#',
  },
  {
    index: '02',
    title: 'Ресепшн',
    desc: 'Архитектурный подход к созданию первого впечатления.',
    img: reception1.src,
    link: '#',
  },
  {
    index: '01',
    title: 'Кухня',
    desc: 'Смелые формы и умная эргономика для тех, кто ценит стиль и комфорт.',
    img: kitchen.src,
    link: '/kitcehn',
  },
];
---

<section class="OurCollectionsMain">
  <div class="OurCollectionsMain-bg">
    <img
      id="bg-image-current"
      src={collections[0].img}
      alt=""
      fetchpriority="high"
    />
    <img
      id="bg-image-next"
      src={collections[0].img}
      alt=""
      loading="lazy"
      style="opacity: 0;"
    />
  </div>

  <span class="OurCollectionsMain-header"
    >ОЗНАКОМЬТЕСЬ С НАШИМИ КОЛЛЕКЦИЯМИ</span
  >

  <div class="OurCollectionsMain-container">
    <div class="OurCollectionsMain-content">
      <div class="content-layer layer-1 active">
        <div class="OurCollectionsMain-title-group">
          <span class="OurCollectionsMain-index">{collections[0].index}</span>
          <div class="OurCollectionsMain-title-group__inner">
            <h2 class="OurCollectionsMain-title">{collections[0].title}</h2>
            <p class="OurCollectionsMain-description">{collections[0].desc}</p>
          </div>
        </div>
      </div>
      <div class="content-layer layer-2">
        <div class="OurCollectionsMain-title-group">
          <span class="OurCollectionsMain-index"></span>
          <div class="OurCollectionsMain-title-group__inner">
            <h2 class="OurCollectionsMain-title"></h2>
            <p class="OurCollectionsMain-description"></p>
          </div>
        </div>
      </div>
    </div>

    <a
      href={collections[0].link}
      id="collection-link"
      class="OurCollectionsMain-cta"
    >
      <span class="OurCollectionsMain-cta__label">Посмотреть коллекцию</span>

      <div class="OurCollectionsMain-cta__arrowWrapper">
        <svg
          class="OurCollectionsMain-cta__arrow"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 45 10"
        >
          <path
            stroke="currentColor"
            stroke-width="1"
            d="M0 5h44m0 0-4-4m4 4-4 4"></path>
        </svg>

        <svg
          class="OurCollectionsMain-cta__arrowHover"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 45 10"
        >
          <path
            stroke="currentColor"
            stroke-width="1"
            d="M0 5h44m0 0-4-4m4 4-4 4"></path>
        </svg>
      </div>
    </a>

    <div class="OurCollectionsMain-visual-wrapper">
      <div class="swiper OurCollectionsSwiper">
        <div class="swiper-wrapper">
          {
            collections.map((item) => (
              <div
                class="swiper-slide"
                data-index={item.index}
                data-title={item.title}
                data-desc={item.desc}
                data-link={item.link}
              >
                <img
                  src={item.img}
                  alt={item.title}
                  class="OurCollectionsMain-img"
                  loading="lazy"
                  decoding="async"
                />
              </div>
            ))
          }
        </div>
      </div>

      <div class="OurCollectionsMain-controls">
        <div class="swiper-navigation-group">
          <button class="swiper-prev" aria-label="Previous slide">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 45 10"
            >
              <path stroke-width="1" d="M0 5h44m0 0-4-4m4 4-4 4"></path>
            </svg>
          </button>
          <button class="swiper-next" aria-label="Next slide">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 45 10"
            >
              <path stroke-width="1" d="M0 5h44m0 0-4-4m4 4-4 4"></path>
            </svg>
          </button>
        </div>

        <div class="swiper-progress-bar">
          <div class="swiper-progress-fill"></div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  import Swiper from 'swiper';
  import { Navigation, Pagination, EffectFade } from 'swiper/modules';

  const swiper = new Swiper('.OurCollectionsSwiper', {
    modules: [Navigation, Pagination, EffectFade],
    loop: false,
    speed: 800,
    effect: 'fade',
    fadeEffect: { crossFade: true },
    navigation: {
      nextEl: '.swiper-next',
      prevEl: '.swiper-prev',
    },
  });

  const progressFill = document.querySelector(
    '.swiper-progress-fill'
  ) as HTMLElement;

  const ctaLink = document.querySelector(
    '.OurCollectionsMain-cta'
  ) as HTMLAnchorElement;

  const updateContent = () => {
    const totalSlides = swiper.slides.length;
    const currentIndex = swiper.activeIndex;
    const activeSlide = swiper.slides[currentIndex];

    if (progressFill) {
      const percentage = ((currentIndex + 1) / totalSlides) * 100;
      progressFill.style.width = `${percentage}%`;
    }

    if (activeSlide && ctaLink) {
      const newHref = activeSlide.getAttribute('data-link') || '#';
      ctaLink.href = newHref;
    }

    const nextImgSrc = activeSlide
      ?.querySelector('.OurCollectionsMain-img')
      ?.getAttribute('src');
    const bgCurrent = document.getElementById(
      'bg-image-current'
    ) as HTMLImageElement;
    const bgNext = document.getElementById('bg-image-next') as HTMLImageElement;

    if (bgCurrent && bgNext && nextImgSrc && bgCurrent.src !== nextImgSrc) {
      bgNext.src = nextImgSrc;
      bgCurrent.style.opacity = '0';
      bgNext.style.opacity = '1';
      setTimeout(() => {
        bgCurrent.src = nextImgSrc;
        bgCurrent.style.opacity = '1';
        bgNext.style.opacity = '0';
      }, 250);
    }

    const layers = document.querySelectorAll('.content-layer');
    const outgoingLayer = document.querySelector(
      '.content-layer.active'
    ) as HTMLElement;
    const incomingLayer = Array.from(layers).find(
      (l) => l !== outgoingLayer
    ) as HTMLElement;

    if (incomingLayer && outgoingLayer && activeSlide) {
      const title = activeSlide.getAttribute('data-title') ?? '';
      const index = activeSlide.getAttribute('data-index') ?? '';
      const desc = activeSlide.getAttribute('data-desc') ?? '';

      incomingLayer.querySelector('.OurCollectionsMain-title')!.textContent =
        title;
      incomingLayer.querySelector('.OurCollectionsMain-index')!.textContent =
        index;
      incomingLayer.querySelector(
        '.OurCollectionsMain-description'
      )!.textContent = desc;

      outgoingLayer.classList.remove('active');
      incomingLayer.classList.add('active');
    }

    const prevBtn = document.querySelector('.swiper-prev') as HTMLButtonElement;
    const nextBtn = document.querySelector('.swiper-next') as HTMLButtonElement;
    if (prevBtn) prevBtn.disabled = swiper.isBeginning;
    if (nextBtn) nextBtn.disabled = swiper.isEnd;
  };

  swiper.on('slideChange', updateContent);

  updateContent();
</script>
